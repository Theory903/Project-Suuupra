server:
  port: 8081

spring:
  main:
    allow-circular-references: true
  cache:
    type: simple
  datasource:
    url: jdbc:postgresql://${POSTGRES_HOST:localhost}:${POSTGRES_PORT:5432}/${POSTGRES_DATABASE:identity}
    username: ${POSTGRES_USER:postgres}
    password: ${POSTGRES_PASSWORD:postgres123}
  jpa:
    hibernate:
      ddl-auto: none
    properties:
      hibernate:
        format_sql: true
  flyway:
    enabled: true
    out-of-order: true
    validate-on-migrate: false
  redis:
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}

# KMS settings (activate profile aws-kms to use AWS KMS)
kms:
  key-id: ""
  # Optional: base64-encoded 256-bit KEK for LocalKmsService in non-dev
  kekBase64: "MDEyMzQ1Njc4OWFiY2RlZjAxMjM0NTY3ODlhYmNkZWY="

security:
  jwt:
    issuer: http://localhost:8081
    audience: suuupra-api
    access-ttl-seconds: 900
    refresh-ttl-seconds: 2592000 # 30 days
    # ES256 keys: provide PEM via env/secret manager in non-dev
    ec:
      private-key-pem: ""
      public-key-pem: ""
  auth:
    rate-limit-per-minute: 60
  require-ssl: false
  # Optional: provide a base64-encoded 256-bit KEK for MFA secret encryption (prod/staging)
  mfa:
    kekBase64: ""
  webauthn:
    rpId: identity.suuupra.local
    rpName: Suuupra Identity
    origins:
      - https://identity.suuupra.local
      - https://console.suuupra.local
    residentKey: preferred
    userVerification: preferred
    attestation: none
    authenticatorAttachment: cross_platform

management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus
  metrics:
    cache:
      instrument: false
  tracing:
    enabled: false
  otlp:
    tracing:
      endpoint: http://otel-collector:4317
    metrics:
      export:
        enabled: false

health:
  readiness:
    state:
      enabled: true
  liveness:
    state:
      enabled: true

oauth:
  clients:

---
spring:
  config:
    activate:
      on-profile: staging
security:
  require-ssl: true
  jwt:
    issuer: https://identity.staging.suuupra.com
  webauthn:
    rpId: identity.staging.suuupra.com
    rpName: Suuupra Identity (Staging)
    origins:
      - https://identity.staging.suuupra.com
      - https://console.staging.suuupra.com
    residentKey: preferred
    userVerification: required
    attestation: indirect
    authenticatorAttachment: cross_platform

---
spring:
  config:
    activate:
      on-profile: prod
security:
  require-ssl: true
  jwt:
    issuer: https://identity.suuupra.com
  webauthn:
    rpId: identity.suuupra.com
    rpName: Suuupra Identity
    origins:
      - https://identity.suuupra.com
      - https://console.suuupra.com
    residentKey: required
    userVerification: required
    attestation: direct
    authenticatorAttachment: platform

oauth:
  clients:
    # Production clients should be added via environment-specific configuration
    # Do not add demo/test clients in production

